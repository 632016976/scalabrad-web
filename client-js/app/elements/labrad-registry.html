<link rel="import" href="../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="app-link.html">
<link rel="import" href="dir-item.html">

<!-- This is the component that simply renders the table of registry content -->
<dom-module id="labrad-registry">
  <style>
    :host {
      display: block;
    }

    #reg-menu {
      position: fixed;
      top: var(--maintoolbar-height);
      width: 100%;
      @apply(--shadow-elevation-2dp);
    }

    #reg-area {
      margin-top: var(--maintoolbar-height);
      background-color: white;
      display: inline-block;
      @apply(--shadow-elevation-2dp);
      height: 100%;
    }

    .iron-selected {
      background-color: #ddd;
    }

    .iron-selector {
      width: 100%;
      display: block;
      border: 1px solid #ccc;
      border-top: none;
    }

    table {
      width: 100%;
    }

    tbody {
      display:table-header-group;
    }
    
    td.dir.over {
      background-color: #93d4d4;
    }

    .table-header {
      @apply(--paper-font-body1);
      color: var(--secondary-text-color);
      *text-align: middle;
      border-bottom: 1px solid;
      border-bottom-color: #e5e5e5;
      display:table-header-group;

    }
    .label-wide {
      width: 100%;
    }
    paper-toolbar {
      background-color: #EEEEEE;
      color: black;
    }

    paper-dialog.size-position {
      position: fixed;
      top: 16p
      right: 16px;
    }
    paper-dialog.size-position {
      width: 300px;
      height: 300px;
    }
    menu-button {
      color: #0F9D58;
    }
    iron-autogrow-textarea {
      max-width: 400px;
    }
    #search-bar {
      padding: 0px 10px;
      flex-grow: 1;
      text-align: right;
    }
    #search-bar input {
      font-family: var(--primary-font-family);
      font-size: 15px;
      width: calc(100% - 50px);
      padding: 10px;
      border: 0;
      border-radius: 2px;
      -webkit-appearance: none;
    }
    dir-item {
      white-space: nowrap;
    }
  </style>
  <template>
    <div id="reg-area">
      <table>
        <tbody is="selectable-table" attr-for-selected="name" selected="{{selDir}}" on-tap="selectDir">
          <template id="dirList" is="dom-repeat" items="{{dirs}}" filter="filterFunc"> 
            <tr name="{{item.name}}">
              <td class="dir" 
                  name="{{item.name}}" 
                  draggable="true" 
                  ondragover="classList.add('over')" 
                  ondragleave="classList.remove('over')" 
                  on-drop="dirDrop">
                <a is="app-link" path="{{item.url}}" href="{{item.url}}">
                  <dir-item kind="folder" >{{item.name}}</dir-item>
                </a>
              </td>
              <td class="label-wide"></td>
            </tr>
          </template>
        </tbody>
        <tbody is="selectable-table" attr-for-selected="name"  selected="{{selKey}}" on-tap="selectKey">
          <template id="keyList" is="dom-repeat" items="{{keys}}" filter="filterFunc">
            <tr class="key" name="{{item.name}}">
              <td>
                <dir-item kind="key">{{item.name}}</dir-item>
              </td>
              <td class="label-wide">
                <paper-item key-name="{{item.name}}" on-dblclick="editValueClicked">{{item.value}}</paper-item>
              </td>
            </tr>
          </template>
        </tbody>
      </table>
    </div>
    <div id="reg-menu">
      <paper-toolbar>
        <paper-button on-click="newKeyClicked">
          <iron-icon icon="create"></iron-icon>
          new key
        </paper-button>
        <paper-button on-click="newFolderClicked">
          <iron-icon icon="folder-open"></iron-icon>
          new dir
        </paper-button>
        <paper-button on-click="copyClicked" disabled="{{!selected}}">
          <iron-icon icon="content-copy"></iron-icon>
          copy
        </paper-button>
        <paper-button on-click="renameClicked" disabled="{{!selected}}">
          <iron-icon icon="code"></iron-icon>
          rename
        </paper-button>
        <paper-button on-click="deleteClicked" disabled="{{!selected}}">
          <iron-icon icon="delete"></iron-icon>
          delete
        </paper-button>
        <div id="search-bar">
          <iron-icon icon="search"></iron-icon>
          <input type="search" id="search" value="{{filterText::input}}" placeholder="search registry">
        </div>
      </paper-toolbar>
    </div>

    <!-- Dialogs for various registry operations -->

    <paper-dialog id="newKeyDialog" modal>
      <h1>Create new key</h1>
      <form>
        <paper-input id="newKeyInput" label="Key"></paper-input>
        <paper-textarea id="newValueInput" label="Value"></paper-textarea>
      </form>
      <div class="buttons"> 
        <paper-button on-click="doNewKey" dialog-confirm>OK</paper-button>
        <paper-button dialog-dismiss>CANCEL</paper-button>
      </div>
    </paper-dialog>

    <paper-dialog id="editValueDialog" modal>
      <h1>Edit <span>{{selKey}}</span></h1>
      <form>
        <paper-textarea id="editValueInput" label="Value"></paper-textarea>
      </form>
      <div class="buttons">
        <paper-button on-click="doEditValue" dialog-confirm autofocus>OK</paper-button>
        <paper-button dialog-dismiss>CANCEL</paper-button>
      </div>
    </paper-dialog>

    <paper-dialog id="newFolderDialog" modal>
      <h1>Create new folder</h1>
      <form>
        <paper-input id="newFolderInput" label="Name"></paper-input>
      </form>
      <div class="buttons">
        <paper-button on-click="doNewFolder" dialog-confirm autofocus>OK</paper-button>
        <paper-button dialog-dismiss>CANCEL</paper-button>
      </div>
    </paper-dialog>
    
     <paper-dialog id="dragCopyDialog" modal>
      <h1>Copy "<span id="originName"></span>" from <span id="originPath"></span></h1>
      <form>
        <paper-input id="dragCopyNameInput" label="New Name" always-float-label></paper-input>
        <paper-input id="dragCopyPathInput" label="New Path" always-float-label></paper-input>
      </form>
      <div class="buttons">
        <paper-button on-click="doDragCopy" dialog-confirm>OK</paper-button>
        <paper-button dialog-dismiss>CANCEL</paper-button>
      </div>
    </paper-dialog>

    <paper-dialog id="copyDialog" modal>
      <h1>Copy <span>{{selectType}}</span> "<span>{{selDir}}</span><span>{{selKey}}</span>"</h1>
      <form>
        <paper-input id="copyNameInput" label="New Name" always-float-label></paper-input>
        <paper-input id="copyPathInput" label="New Path" always-float-label></paper-input>
      </form>
      <div class="buttons">
        <paper-button on-click="doCopy" dialog-confirm>OK</paper-button>
        <paper-button dialog-dismiss>CANCEL</paper-button>
      </div>
    </paper-dialog>

    <paper-dialog id="renameDialog" modal>
      <h1>Rename <span>{{selectType}}</span> "<span>{{selDir}}</span><span>{{selKey}}</span>"</h1>
      <form>
        <paper-input id="renameInput" label="New Name" always-float-label></paper-input>
      </form>
      <div class="buttons">
        <paper-button on-click="doRename" dialog-confirm autofocus>OK</paper-button>
        <paper-button dialog-dismiss>CANCEL</paper-button>
      </div>
    </paper-dialog>

    <paper-dialog id="deleteDialog" modal>
      <h1>Delete <span>{{selectType}}</span> "<span>{{selDir}}</span><span>{{selKey}}</span>"?</h1>
      <div class="buttons">
        <paper-button on-click="doDelete" dialog-confirm autofocus>OK</paper-button>
        <paper-button dialog-dismiss>CANCEL</paper-button>
      </div>
    </paper-dialog>
    
    <paper-toast id="toastText" text="tada"></paper-toast>
  </template>
</dom-module>
